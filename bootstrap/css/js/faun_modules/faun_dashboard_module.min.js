var url="https://connect.faun.fr/api/public",FaunDashboardModule={version:1.1,description:"Module which contains dashboard functions such as indicators and map",map:{lastKnownPosition:function(b){if($.isEmptyObject(b))console.log("Error: no data.");else{var a=L.map("park_card").setView([46.5418955,2.2833633],6),c=L.AwesomeMarkers.icon({icon:"truck",prefix:"fa",markerColor:"green"}),d=L.AwesomeMarkers.icon({icon:"truck",prefix:"fa",markerColor:"blue"}),g=L.AwesomeMarkers.icon({icon:"truck",prefix:"fa",
markerColor:"red"});L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'Powered by \u00a9 <a href="//osm.org/copyright">OpenStreetMap</a>',minZoom:2,maxZoom:18}).addTo(a);a.addControl(new L.Control.Fullscreen);var q=L.markerClusterGroup({maxClusterRadius:80}),m=[];$.each(b,function(b,a){var n="<b id='popupTruck' class='trn'>popup.Truck</b><b>"+a.rcv_number+"</b></br>Status: "+a.status+"</br> Last com: "+a.timestamp+"</br><a href='truck_tracking.php?id_vehicule="+a.vehicle_id+
"' class='trn'>See the truck</a></p>",k="online"===a.status?L.marker([a.latitude,a.longitude],{icon:c}):"offline"===a.status?L.marker([a.latitude,a.longitude],{icon:d}):L.marker([a.latitude,a.longitude],{icon:g});q.addLayer(k);k.bindPopup(n);m.push(k)});a.addLayer(q)}}},indicators:{lastCommunicationDate:function(b){if($.isEmptyObject(b))console.log("Error: no data.");else{var a=[],c=[],d=[],g=[],q=[],m=0,k=0,n=0,t=0,u=0,l=[];$("#today-com-p").remove();$("#yesterday-com-p").remove();$("#last-week-com-p").remove();
$("#last-month-com-p").remove();$("#older-com-p").remove();$("#today-number").remove();$("#yesterday-number").remove();$("#last-week-number").remove();$("#last-month-number").remove();$("#older-number").remove();var h=new Date,e=h.getMonth()+1,r=h.getDate(),p=h.getFullYear()+"-"+(2>(""+e).length?"0":"")+e+"-"+(2>(""+r).length?"0":"")+r;h=h.getFullYear()+"-"+(2>(""+e).length?"0":"")+e+"-"+(2>(""+(r-1)).length?"0":"")+(r-1);var v=new Date(p+" 00:00:00.0"),w=new Date(h+" 00:00:00.0");e=function(){var a=
new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate()-7)}();p=e.getMonth()+1;h=e.getDate();e=e.getFullYear();var x=new Date(p+"/"+h+"/"+e+" 00:00:00.0");e=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth()-1,a.getDate())}();p=e.getMonth()+1;h=e.getDate();e=e.getFullYear();var y=new Date(p+"/"+h+"/"+e+" 00:00:00.0");$.each(b,function(b,f){var e=new Date(f.timestamp);e>=v?(m+=1,a.push(f.rcv_number),$("#today-com").append('<a style="font-size: 12px; text-decoration: underline; color: #009fe5;" href="truck_tracking.php"<label id="today-com-p" style="font-size: 12px; text-decoration: underline; color: #333;">'+
f.rcv_number+'</label></a>&nbsp;<label style="font-size: 12px; color: #333;"> - Last message: '+f.timestamp+' </label><hr id="hr-accordion">'),$("#today-com").trigger("traduction"),$("#today-com").on("click","a",function(){var a=$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:f.vehicle_id}))})):e>=w&&e<v?(k+=1,c.push(f.rcv_number),$("#yesterday-com").append('<a style="font-size: 12px; text-decoration: underline; color: #009fe5;" href="truck_tracking.php"<label id="yesterday-com-p" style="font-size: 12px; text-decoration: underline; color: #333;">'+
f.rcv_number+'</label></a>&nbsp;<label style="font-size: 12px; color: #333;"> - Last message: '+f.timestamp+' </label><hr id="hr-accordion">'),$("#yesterday-com").trigger("traduction"),$("#yesterday-com").on("click","a",function(){var a=$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:f.vehicle_id}))})):e>=x&&e<w?(n+=1,d.push(f.rcv_number),$("#last-week-com").append('<a style="font-size: 12px; text-decoration: underline; color: #009fe5;" href="truck_tracking.php"<label id="last-week-com-p" style="font-size: 12px; text-decoration: underline; color: #333;">'+
f.rcv_number+'</label></a>&nbsp;<label style="font-size: 12px; color: #333;"> - Last message: '+f.timestamp+' </label><hr id="hr-accordion">'),$("#last-week-com").trigger("traduction"),$("#last-week-com").on("click","a",function(){var a=$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:f.vehicle_id}))})):e>=y&&e<x?(t+=1,g.push(f.rcv_number),$("#last-month-com").append('<a style="font-size: 12px; text-decoration: underline; color: #009fe5;" href="truck_tracking.php"<label id="last-month-com-p" style="font-size: 12px; text-decoration: underline; color: #333;">'+
f.rcv_number+'</label></a>&nbsp;<label style="font-size: 12px; color: #333;"> - Last message: '+f.timestamp+' </label><hr id="hr-accordion">'),$("#last-month-com").trigger("traduction"),$("#last-month-com").on("click","a",function(){var a=$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:f.vehicle_id}))})):(u+=1,q.push(f.rcv_number),$("#older-com").append('<a style="font-size: 12px; text-decoration: underline; color: #333;" href="truck_tracking.php"<label id="older-com-p" style="font-size: 12px; text-decoration: underline; color: #333;">'+
f.rcv_number+'</label></a>&nbsp;<label style="font-size: 12px; color: #333;"> - Last message: '+f.timestamp+' </label><hr id="hr-accordion">'),$("#older-com").trigger("traduction"),$("#older-com").on("click","a",function(){var a=$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:f.vehicle_id}))}))});l.push(m);l.push(k);l.push(n);l.push(t);l.push(u);$("#accordion-today").append('<span id="today-number" class="pull-left trn">card.Today</span><span class="pull-right trn">'+
m+"</span>");$("#accordion-yesterday").append('<span id="yesterday-number" class="pull-left trn">card.LastDay</span><span class="pull-right trn">'+k+"</span>");$("#accordion-last-week").append('<span id="last-week-number" class="pull-left trn">card.LastWeek</span><span class="pull-right trn">'+n+"</span>");$("#accordion-last-month").append('<span id="last-month-number" class="pull-left trn">card.LastMonth</span><span class="pull-right trn">'+t+"</span>");$("#accordion-older").append('<span id="older-number" class="pull-left trn">card.Older</span><span class="pull-right trn">'+
u+"</span>");$("#accordion-today").trigger("traduction");b=document.getElementById("lastComChart").getContext("2d");b.canvas.height=180;comChart=new Chart(b,{type:"doughnut",data:{labels:["Today","Yesterday","Last Week","Last Month","Older"],datasets:[{backgroundColor:["#5cd65c","#ffaa12","#a68500","#ff4d4d","#7f7f7f"],data:l}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!0,position:"right"},onClick:function(a){a=comChart.getElementsAtEvent(a);a[0]&&(a=a[0]._chart.config.data.labels[a[0]._index],
$("#btn-flip-to-front-last-com").trigger("click"),"Today"===a?$("#accordion-today").trigger("click"):"Yesterday"===a?$("#accordion-yesterday").trigger("click"):"Last Week"===a?$("#accordion-last-week").trigger("click"):"Last Month"===a?$("#accordion-last-month").trigger("click"):"Older"===a&&$("#accordion-older").trigger("click"))}}})}},connectedTrucks:function(b){if($.isEmptyObject(b))console.log("Error: no data.");else{var a=[],c=0,d=0,g=[];$("#online-truck-details").remove();$("#offline-truck-details").remove();
$.each(b,function(a,b){"online"===b.status?(d+=1,$("#online-truck-list").append('<a style="font-size: 12px; text-decoration: underline; color: #009fe5;" href="truck_tracking.php"<label id="online-truck-details" style="font-size: 12px; text-decoration: underline; color: #333;">'+b.rcv_number+'</label></a>&nbsp;<label class="trn" style="font-size: 12px; color: #333;">is.Online</label><hr id="hr-accordion">'),$("#online-truck-list").trigger("traduction"),$("#online-truck-list").on("click","a",function(){var a=
$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:b.vehicle_id}))})):(c+=1,$("#offline-truck-list").append('<a style="font-size: 12px; text-decoration: underline; color: #009fe5;" href="truck_tracking.php"<label id="offline-truck-details" style="font-size: 12px; text-decoration: underline; color: #333;">'+b.rcv_number+'</label></a>&nbsp;<label class="trn" style="font-size: 12px; color: #333;">is.Offline</label><hr id="hr-accordion">'),$("#offline-truck-list").trigger("traduction"),
$("#offline-truck-list").on("click","a",function(){var a=$(this).text();localStorage.setItem("selectedVehicletab",JSON.stringify({name:a,id:b.vehicle_id}))}));g.push(b.timestamp)});a.push(d);a.push(c);$("#accordion-online").append('<span id="online-number" class="pull-left trn">available.Trucks</span><span class="pull-right">'+d+"</span>");$("#accordion-offline").append('<span id="offline-number" class="pull-left trn">unavailable.Trucks</span><span class="pull-right">'+c+"</span>");$("#accordion-online").trigger("traduction");
statChart=new Chart(statusChart,{type:"doughnut",data:{labels:["Online","Offline"],datasets:[{backgroundColor:["#5cd65c","#009fe5"],data:a}]},options:{responsive:!0,maintainAspectRatio:!1,legend:{display:!0,position:"right"},onClick:function(a){a=statChart.getElementsAtEvent(a);a[0]&&(a=a[0]._chart.config.data.labels[a[0]._index],$("#btn-flip-to-front-available-trucks").trigger("click"),"Online"===a?$("#accordion-online").trigger("click"):"Offline"===a&&$("#accordion-offline").trigger("click"))}}})}},
totalDistanceDay:function(){var b=localStorage.aggregationValue,a=new Date,c=a.getMonth(),d=a.getDate();a=a.getFullYear();c=moment(new Date(a,c,d,0,0,0)).format("YYYY-MM-DD HH:mm:ss"),d=moment(new Date).format("YYYY-MM-DD HH:mm:ss");b=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$("#today-distance-indicator-details").remove();$("#hr-distance").remove();$("#hr-consumption").remove();$.ajax({type:"POST",url:url+"/vehicle_total_distance/"+b,
dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:c,end_timestamp:d},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Vehicle_total_distance,$("#today-indicator-list").append('<div class="row" id="today-distance-indicator-details"><div class="col-md-12"><i class="fas fa-road fa-fw"></i>&nbsp;&nbsp;&nbsp;<span><span class="trn">total.Distance</span><span class="float-right"> '+a+' km</span></span></div></div><hr id="hr-distance">'),$("#today-indicator-list").trigger("traduction")):
console.log("No data to draw.")},error:function(a){console.log(a)}})},totalDistanceYesterday:function(){var b=new Date,a=b.getMonth(),c=b.getDate()-1,d=b.getFullYear();b=moment(new Date(d,a,c,0,0,0)).format("YYYY-MM-DD HH:mm:ss");c=moment(new Date(d,a,c,23,59,59)).format("YYYY-MM-DD HH:mm:ss");a=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$("#yesterday-distance-indicator-details").remove();$("#hr-distance").remove();$("#hr-consumption").remove();
$.ajax({type:"POST",url:url+"/vehicle_total_distance/"+a,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Vehicle_total_distance,$("#yesterday-indicator-list").append('<div class="row" id="yesterday-distance-indicator-details"><div class="col-md-12"><i class="fas fa-road fa-fw"></i>&nbsp;&nbsp;&nbsp;<span><span class="trn">total.Distance</span><span class="float-right"> '+a+' km</span></span></div></div><hr id="hr-distance">'),
$("#yesterday-indicator-list").trigger("traduction")):console.log("No data to draw.")},error:function(a){console.log(a)}})},averageSpeedDay:function(){var b=new Date,a=b.getMonth(),c=b.getDate();b=b.getFullYear();c=moment(new Date(b,a,c,0,0,0)).format("YYYY-MM-DD HH:mm:ss");b=moment(new Date).format("YYYY-MM-DD HH:mm:ss");a=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$("#today-average-speed-indicator-details").remove();$("#hr-speed").remove();
$.ajax({type:"POST",url:url+"/average_speed/"+a,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:c,end_timestamp:b},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Average_speed_day,$("#today-indicator-list").append('<div class="row" id="today-average-speed-indicator-details"><div class="col-md-12"><i class="fas fa-tachometer-alt fa-fw"></i>&nbsp;&nbsp;&nbsp;<span><span class="trn">average.Speed</span><span class="float-right">'+a+' km/h</span></span></div></div><hr id="hr-speed">'),
$("#today-indicator-list").trigger("traduction")):console.log("No data to draw.")},error:function(a){console.log(a)}})},averageSpeedYesterday:function(){var b=new Date,a=b.getMonth(),c=b.getDate()-1,d=b.getFullYear();b=moment(new Date(d,a,c,0,0,0)).format("YYYY-MM-DD HH:mm:ss");c=moment(new Date(d,a,c,23,59,59)).format("YYYY-MM-DD HH:mm:ss");a=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$("#yesterday-average-speed-indicator-details").remove();
$("#hr-speed").remove();$.ajax({type:"POST",url:url+"/average_speed/"+a,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Average_speed_day,$("#yesterday-indicator-list").append('<div class="row" id="yesterday-average-speed-indicator-details"><div class="col-md-12"><i class="fas fa-tachometer-alt fa-fw"></i>&nbsp;&nbsp;&nbsp;<span><span class="trn">average.Speed</span><span class="float-right">'+
a+' km/h</span></span></div></div><hr id="hr-speed">'),$("#yesterday-indicator-list").trigger("traduction")):console.log("No data to draw.")},error:function(a){console.log(a)}})},emptyiedBinsDay:function(){function b(a){if(0!=a){var b=0;$.each(a,function(a,c){b+=c.Left_Emptied_bins+c.Right_Emptied_bins+c.Middle_Emptied_bins+c.Large_Emptied_bins});$("#today-indicator-list").append('<div class="row" id="today-nb-emptied-bin-indicator-details"><div class="col-md-12"><i class="fas fa-trash fa-fw"></i>&nbsp;&nbsp;&nbsp;<span><span class="trn">emptied.Bin</span><span class="float-right">'+
b+'</span></span></div></div><hr id="hr-speed">');$("#today-indicator-list").trigger("traduction")}else console.log("No data to draw.")}var a=new Date,c=a.getMonth(),d=a.getDate(),g=a.getFullYear();a=moment(new Date(g,c,d,0,0,0)).format("YYYY-MM-DD HH:mm:ss");d=moment(new Date(g,c,d,23,59,59)).format("YYYY-MM-DD HH:mm:ss");c=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$("#today-nb-emptied-bin-indicator-details").remove();$("#hr-speed").remove();
$.ajax({type:"POST",url:url+"/emptied_bin_indic/"+c,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:a,end_timestamp:d},headers:{"faun-token":token},success:function(a){b(a)},error:function(a){console.log(a)}})},emptyiedBinsYesterday:function(){function b(a){if(0!=a){var b=0;$.each(a,function(a,c){b+=c.Left_Emptied_bins+c.Right_Emptied_bins+c.Middle_Emptied_bins+c.Large_Emptied_bins});$("#yesterday-indicator-list").append('<div class="row" id="yesterday-nb-emptied-bin-indicator-details"><div class="col-md-12"><i class="fas fa-trash fa-fw"></i>&nbsp;&nbsp;&nbsp;<span><span class="trn">emptied.Bin</span><span class="float-right">'+
b+'</span></span></div></div><hr id="hr-speed">');$("#yesterday-indicator-list").trigger("traduction")}else console.log("No data to draw.")}var a=new Date,c=a.getMonth(),d=a.getDate()-1,g=a.getFullYear();a=moment(new Date(g,c,d,0,0,0)).format("YYYY-MM-DD HH:mm:ss");d=moment(new Date(g,c,d,23,59,59)).format("YYYY-MM-DD HH:mm:ss");c=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$("#yesterday-nb-emptied-bin-indicator-details").remove();$("#hr-speed").remove();
$.ajax({type:"POST",url:url+"/emptied_bin_indic/"+c,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:a,end_timestamp:d},headers:{"faun-token":token},success:function(a){b(a)},error:function(a){console.log(a)}})},maxSpeedDay:function(){var b=new Date,a=b.getMonth(),c=b.getDate();b=b.getFullYear();c=moment(new Date(b,a,c,0,0,0)).format("YYYY-MM-DD HH:mm:ss");b=moment(new Date).format("YYYY-MM-DD HH:mm:ss");a=localStorage.selectedVehicletab&&localStorage.truckList?
JSON.parse(localStorage.selectedVehicletab).id:0;$.ajax({type:"POST",url:url+"/max_speed/"+a,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:c,end_timestamp:b},headers:{"faun-token":token},success:function(a){if(0!=a){a=a.Max_speed_day;$("#perfChartLabel").remove();$("#perf_indicator_div").append('<lavel id="perfChartLabel">'+a+" km/h</label>");var b=document.getElementById("perfChart");b=(new Gauge(b)).setOptions({angle:-.2,lineWidth:.2,radiusScale:1,pointer:{length:.6,
strokeWidth:.035,color:"#000000"},staticZones:[{strokeStyle:"#5cd65c",min:0,max:70},{strokeStyle:"#ffaa12",min:70,max:90},{strokeStyle:"#ff4d4d",min:90,max:110}],staticLabels:{font:"10px sans-serif",labels:[0,70,90,110],color:"#000000",fractionDigits:0},limitMax:!1,limitMin:!1,colorStart:"#ff4d4d",colorStop:"#5cd65c",strokeColor:"#EEEEEE",generateGradient:!0,highDpiSupport:!0});b.maxValue=110;b.setMinValue(0);b.animationSpeed=32;b.set(a)}else console.log("No data to draw.")},error:function(a){console.log(a)}})},
maxSpeedYesterday:function(){var b=new Date,a=b.getMonth(),c=b.getDate()-1,d=b.getFullYear();b=moment(new Date(d,a,c,0,0,0)).format("YYYY-MM-DD HH:mm:ss");c=moment(new Date(d,a,c,23,59,59)).format("YYYY-MM-DD HH:mm:ss");a=localStorage.selectedVehicletab&&localStorage.truckList?JSON.parse(localStorage.selectedVehicletab).id:0;$.ajax({type:"POST",url:url+"/max_speed/"+a,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"day",start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},
success:function(a){if(0!=a){a=a.Max_speed_day;$("#perfChartLabel").remove();$("#perf_indicator_div").append('<lavel id="perfChartLabel">'+a+" km/h</label>");var b=document.getElementById("perfChart");b=(new Gauge(b)).setOptions({angle:-.2,lineWidth:.2,radiusScale:1,pointer:{length:.6,strokeWidth:.035,color:"#000000"},staticZones:[{strokeStyle:"#5cd65c",min:0,max:70},{strokeStyle:"#ffaa12",min:70,max:90},{strokeStyle:"#ff4d4d",min:90,max:110}],staticLabels:{font:"10px sans-serif",labels:[0,70,90,
110],color:"#000000",fractionDigits:0},limitMax:!1,limitMin:!1,colorStart:"#ff4d4d",colorStop:"#5cd65c",strokeColor:"#EEEEEE",generateGradient:!0,highDpiSupport:!0});b.maxValue=110;b.setMinValue(0);b.animationSpeed=32;b.set(a)}else console.log("No data to draw.")},error:function(a){console.log(a)}})}}};