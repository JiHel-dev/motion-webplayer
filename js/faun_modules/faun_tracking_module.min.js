var url="https://connect.faun.fr/api/public",total_distance=0,FaunTrackingModule={version:1.1,description:"Main module which contains tracking functions",init:{map:function(){}},get:{truckPath:function(b,c,d){function a(a){$("#truck_card").remove();$("#divMap").append('<div id="truck_card"></div>');var b=0;macarte=L.map("truck_card").setView([44.927391,4.862353],5);macarte.on("popupopen",function(a){$.refreshTranslation()});L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'Powered by \u00a9 <a href="//osm.org/copyright">OpenStreetMap</a>',
minZoom:1,maxZoom:18}).addTo(macarte);macarte.addControl(new L.Control.Fullscreen);var c=[];if(0!=a){var d=0;rcv=a[0].rcv_number;$.each(a,function(b,e){d+=parseInt(e.speed,10);if(0==b){var f=L.marker([e.latitude,e.longitude],{icon:h}).addTo(macarte),g="<p><ins><b class='trn'>popup.Truck</b><b>"+e.rcv_number+"</b></ins></br>Timestamp: "+e.timestamp+"</br>Speed: "+e.speed+" km/h</br>Altitude: "+e.altitude+" m</br></p>";f.bindPopup(g)}b==a.length-1&&(f=L.marker([e.latitude,e.longitude],{icon:k}).addTo(macarte),
g="<p><ins><b class='trn'>popup.Truck</b><b>"+e.rcv_number+"</b></ins></br>Timestamp: "+e.timestamp+"</br>Speed: "+e.speed+" km/h</br>Altitude: "+e.altitude+" m</br></p>",f.bindPopup(g));c.push([e.latitude,e.longitude])});b=L.polyline(c,{color:"#990099"}).addTo(macarte);macarte.fitBounds(b.getBounds());var f=b.getDistance();b=d/a.length;console.log("length:",a.length);console.log("average speed: ",b);$("#card-distance").append('<div id="card-distance-value" class="card-body trn">'+f.toFixed(2)+" km</div>");
$("#card-speed").append('<div id="card-speed-value" class="card-body trn">'+b.toFixed(2)+" km/h</div>");$("#card-altitude").append('<div id="card-altitude-value" class="card-body trn">'+(0).toFixed(2)+" m</div>");console.log("distance",f);console.log("average altitude",0)}else alert("No data to draw!")}L.Polyline=L.Polyline.include({getDistance:function(){for(var a=0,b=this._latlngs.length,c=3;c<b;c+=3)a+=this._latlngs[c].distanceTo(this._latlngs[c-3]);return a/1E3}});L.AwesomeMarkers.icon({icon:"truck",
prefix:"fa",markerColor:"green"});var h=L.AwesomeMarkers.icon({icon:"truck",prefix:"fa",markerColor:"blue"}),k=L.AwesomeMarkers.icon({icon:"truck",prefix:"fa",markerColor:"red"});$.ajax({type:"POST",headers:{"faun-token":token},data:{timezone:localStorage.timezone,start_timestamp:b,end_timestamp:c},url:url+"/geolocations/"+d,dataType:"json",success:function(b){a(b)},error:function(a){alert(a.responseJSON.msg);console.log(a)}})},totalDistance:function(b,c,d){$("#total_distance_indic").remove();$.ajax({type:"POST",
url:url+"/vehicle_total_distance/"+d,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"hour",start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},success:function(a){total_distance=0;0!=a?(total_distance=a.Vehicle_total_distance,$("#total_distance_div").append('<span id="total_distance_indic"><h5>'+total_distance+" km</h5></span>")):console.log("No data to draw.")},error:function(a){console.log(a)}})},maxSpeed:function(b,c,d){$("#max_speed_indic").remove();$.ajax({type:"POST",
url:url+"/max_speed/"+d,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"hour",start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Max_speed_hour,$("#max_speed_div").append('<span id="max_speed_indic"><h5>'+a+" km/h</h5></span>")):console.log("No data to draw.")},error:function(a){console.log(a)}})},averageSpeed:function(b,c,d){$("#average_speed_indic").remove();$.ajax({type:"POST",url:url+"/average_speed/"+d,dataType:"json",data:{timezone:localStorage.timezone,
aggregation:"hour",start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Average_speed_hour,$("#average_speed_div").append('<span id="average_speed_indic"><h5>'+a+" km/h</h5></span>")):console.log("No data to draw.")},error:function(a){console.log(a)}})},emptyiedBins:function(b,c,d){$("#emptyied_bins_indic").remove();$.ajax({type:"POST",url:url+"/emptied_bin_indic/"+d,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"hour",start_timestamp:b,
end_timestamp:c},headers:{"faun-token":token},success:function(a){0!=a?(a=0+(a.Left_Emptied_bins+a.Right_Emptied_bins+a.Middle_Emptied_bins+a.Large_Emptied_bins),$("#emptyied_bins_div").append('<span id="emptyied_bins_indic"><h5>'+a+"</h5></span>")):console.log("No data to draw.")},error:function(a){console.log(a)}})},collectionTime:function(b,c,d){$("#collection_time_indic").remove();$.ajax({type:"POST",url:url+"/total_collect_time/"+d,dataType:"json",data:{timezone:localStorage.timezone,aggregation:"hour",
start_timestamp:b,end_timestamp:c},headers:{"faun-token":token},success:function(a){0!=a?(a=a.Timestamp,$("#collection_time_div").append('<span id="collection_time_indic"><h5>'+a+"</h5></span>")):console.log("No data to draw.")},error:function(a){console.log(a)}})},usedFuel:function(b,c,d){$("#used_fuel_indic").remove();b=total_distance;c=60*b/100;console.log(b+" km");$("#used_fuel_div").append('<span id="used_fuel_indic"><h5>'+c+" L</h5></span>")}}};